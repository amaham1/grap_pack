<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="co.grap.pack.qrgen.auth.mapper.QrGenUserMapper">

    <resultMap id="qrGenUserResultMap" type="co.grap.pack.qrgen.auth.model.QrGenUser">
        <id property="qrGenUserId" column="qr_gen_user_id"/>
        <result property="qrGenUserUsername" column="qr_gen_user_username"/>
        <result property="qrGenUserPassword" column="qr_gen_user_password"/>
        <result property="qrGenUserEmail" column="qr_gen_user_email"/>
        <result property="qrGenUserNickname" column="qr_gen_user_nickname"/>
        <result property="qrGenUserIsActive" column="qr_gen_user_is_active"/>
        <result property="qrGenUserCreatedAt" column="qr_gen_user_created_at"/>
        <result property="qrGenUserUpdatedAt" column="qr_gen_user_updated_at"/>
        <result property="qrGenUserLastLoginAt" column="qr_gen_user_last_login_at"/>
    </resultMap>

    <!-- 사용자명으로 조회 -->
    <select id="findByUsername" resultMap="qrGenUserResultMap">
        SELECT *
        FROM qr_gen_user
        WHERE qr_gen_user_username = #{username}
    </select>

    <!-- 이메일로 조회 -->
    <select id="findByEmail" resultMap="qrGenUserResultMap">
        SELECT *
        FROM qr_gen_user
        WHERE qr_gen_user_email = #{email}
    </select>

    <!-- ID로 조회 -->
    <select id="findById" resultMap="qrGenUserResultMap">
        SELECT *
        FROM qr_gen_user
        WHERE qr_gen_user_id = #{id}
    </select>

    <!-- 사용자 등록 -->
    <insert id="insert" parameterType="co.grap.pack.qrgen.auth.model.QrGenUser"
            useGeneratedKeys="true" keyProperty="qrGenUserId">
        INSERT INTO qr_gen_user (
            qr_gen_user_username,
            qr_gen_user_password,
            qr_gen_user_email,
            qr_gen_user_nickname,
            qr_gen_user_is_active,
            qr_gen_user_created_at
        ) VALUES (
            #{qrGenUserUsername},
            #{qrGenUserPassword},
            #{qrGenUserEmail},
            #{qrGenUserNickname},
            #{qrGenUserIsActive},
            NOW()
        )
    </insert>

    <!-- 사용자 정보 수정 -->
    <update id="update" parameterType="co.grap.pack.qrgen.auth.model.QrGenUser">
        UPDATE qr_gen_user
        SET qr_gen_user_nickname = #{qrGenUserNickname},
            qr_gen_user_email = #{qrGenUserEmail}
        WHERE qr_gen_user_id = #{qrGenUserId}
    </update>

    <!-- 마지막 로그인 시간 업데이트 -->
    <update id="updateLastLoginAt">
        UPDATE qr_gen_user
        SET qr_gen_user_last_login_at = NOW()
        WHERE qr_gen_user_id = #{id}
    </update>

    <!-- 사용자명 중복 확인 -->
    <select id="countByUsername" resultType="int">
        SELECT COUNT(*)
        FROM qr_gen_user
        WHERE qr_gen_user_username = #{username}
    </select>

    <!-- 이메일 중복 확인 -->
    <select id="countByEmail" resultType="int">
        SELECT COUNT(*)
        FROM qr_gen_user
        WHERE qr_gen_user_email = #{email}
    </select>

</mapper>
