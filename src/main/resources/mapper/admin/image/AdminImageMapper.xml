<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="co.grap.pack.admin.image.mapper.AdminImageMapper">

    <!-- 이미지 결과 매핑 -->
    <resultMap id="imageResultMap" type="AdminImage">
        <id property="imageId" column="image_id"/>
        <result property="contentId" column="content_id"/>
        <result property="originalName" column="original_name"/>
        <result property="savedName" column="saved_name"/>
        <result property="filePath" column="file_path"/>
        <result property="fileSize" column="file_size"/>
        <result property="displayOrder" column="display_order"/>
        <result property="createDt" column="create_dt"/>
    </resultMap>

    <!-- 콘텐츠별 이미지 목록 조회 -->
    <select id="selectImageListByContentId" parameterType="long" resultMap="imageResultMap">
        SELECT image_id, content_id, original_name, saved_name, file_path,
               file_size, display_order, create_dt
        FROM image
        WHERE content_id = #{contentId}
        ORDER BY display_order ASC, create_dt ASC
    </select>

    <!-- 이미지 상세 조회 -->
    <select id="selectImageById" parameterType="long" resultMap="imageResultMap">
        SELECT image_id, content_id, original_name, saved_name, file_path,
               file_size, display_order, create_dt
        FROM image
        WHERE image_id = #{imageId}
    </select>

    <!-- 이미지 등록 -->
    <insert id="insertImage" parameterType="AdminImage"
            useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO image (content_id, original_name, saved_name, file_path,
                          file_size, display_order, create_dt)
        VALUES (#{contentId}, #{originalName}, #{savedName}, #{filePath},
                #{fileSize}, #{displayOrder}, NOW())
    </insert>

    <!-- 이미지 삭제 -->
    <delete id="deleteImage" parameterType="long">
        DELETE FROM image
        WHERE image_id = #{imageId}
    </delete>

    <!-- 콘텐츠의 이미지 전체 삭제 -->
    <delete id="deleteImagesByContentId" parameterType="long">
        DELETE FROM image
        WHERE content_id = #{contentId}
    </delete>

    <!-- 콘텐츠의 이미지 개수 조회 -->
    <select id="selectImageCountByContentId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM image
        WHERE content_id = #{contentId}
    </select>

</mapper>
